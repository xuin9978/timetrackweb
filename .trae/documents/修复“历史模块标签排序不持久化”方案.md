## 问题分析
- 现状：在“标签管理”中拖拽排序后点“保存排序”，重登后顺序未保留。
- 现象来源：保存按钮触发 `onSaveOrder` → 应用侧 `handleSaveTagOrder` 调用 `updateTagOrder`；但数据库表 `public.tags` 不含 `order` 列，导致云端持久化失败，仅落本地 `localStorage`。
- 代码证据：
  - 保存按钮：components/TagManagerModal.tsx:139-144
  - 触发保存：App.tsx:285-294（根目录版，index.tsx:3 引用的是根 `./App.tsx`）
  - 云端持久化：utils/tagService.ts:198-231（失败时仅返回 true 并写入本地）
  - 获取标签时优先按 `order`，失败回退：utils/tagService.ts:10-51、54-100
  - 现有表结构无 `order`：supabase/migrations/002_tags.sql:1-8

## 原因分析
- 云端缺列：没有 `order` 字段，`upsert` 时报错，被代码吞掉并改为本地排序。
- 跨设备/隐私模式：本地 `localStorage` 不是账号级别存储，换设备或清理缓存后丢失。
- 游客模式：`handleSaveTagOrder` 在未登录时直接返回（App.tsx:286），导致点击“保存排序”只清除“未保存”提示，但不做任何持久化。

## 改进方案
1. 数据库补列
   - 新增迁移：为 `public.tags` 增加 `order int` 列（默认空）。
   - 迁移文件示例：
     - `alter table public.tags add column if not exists "order" integer;`
   - RLS 无需改动（行级策略按 `user_id`）。

2. 云端写入与读取
   - 写入：现有 `updateTagOrder` 已做 `upsert`，补列后即可生效。
   - 读取：`fetchTags` 首选 `select id,label,color,icon,created_at,order` 并 `order('order', asc).order('created_at', asc)`；保留本地回退逻辑作为离线备份。

3. 游客与本地备份优化
   - 游客模式允许保存到本地：`handleSaveTagOrder` 在未登录时也写 `localStorage`（并提示“已保存在本地，登录后可云端同步”）。
   - 保留现有本地键：`tag_order_${userId}`；游客使用 `tag_order_guest` 键。

4. 代码梳理
   - 确认实际运行的 `App.tsx` 为根目录版本；`components/App.tsx` 可保留但避免混淆（不改动逻辑）。

## 验证步骤
- 登录账号 A → 打开历史 → 拖拽排序 → 点“保存排序”。
- 刷新页面、退出并重新登录账号 A：顺序仍保持。
- 在另一设备登录账号 A：顺序保持（验证云端持久化）。
- 离线状态排序并保存：刷新后仍按本地顺序；上线后再次点击保存同步云端。

## 交付改动点
- 新增迁移文件：`supabase/migrations/003_add_order_to_tags.sql`（仅添加列）。
- 无需改动前端取/存接口；仅将游客保存走本地备份路径、提示文案。